{% extends "base.html" %}

{% load static %}

{% block title %}MyTravelBook{% endblock %}

{% block content %}
{% include 'base_breadcrumb.html' %} <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->

{% include "base_tabs.html" with active_tab="travelmemo" %} <!-- ã‚¿ãƒ– -->

<div id="delete-all-memos">
    <form action="{% url 'delete_all_memos' travel_record.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" onclick="return confirm('ã“ã®æ“ä½œã¯ã‚‚ã¨ã«æˆ»ã›ã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">ã™ã¹ã¦ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤</button>
    </form>
</div>

<div id="memo-list">
    {% for memo in memos %}
        <div class="memo">
            <p>{{ memo.memo_text }}</p>
            <p>æŠ•ç¨¿æ—¥æ™‚: {{ memo.created_at }}</p>

            <!-- ä½ç½®æƒ…å ±ã®è¡¨ç¤º -->
            {% if memo.memo_location %}
                <p>{{ memo.memo_location }}</p>
            {% endif %}

            {% if memo.memo_photo_path %}
                <img src="{{ memo.memo_photo_path.url }}" alt="ãƒ¡ãƒ¢ã®ç”»åƒ" style="max-width: 300px;">
            {% endif %}

            {% if memo.audio_path %}
                <audio controls>
                    <source src="{{ memo.audio_path.url }}" type="audio/mp3">
                    ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¿ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
                </audio>
            {% endif %}

            <form action="{% url 'delete_memo' memo.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">å‰Šé™¤</button>
            </form>
        </div>
    {% endfor %}
</div>

<div id="memo-form">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- ãƒ¡ãƒ¢ã®ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› -->
        <textarea id="memo_text" name="memo_text" placeholder="ã“ã“ã«ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>

        <!-- ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <div class="file-input">
            <label for="memo_photo_path">å†™çœŸã‚’è¿½åŠ </label>
            {{ form.memo_photo_path }}
        </div>

        <!-- éŸ³å£°éŒ²éŸ³ã®ãƒœã‚¿ãƒ³ -->
        <button type="button" id="record-btn">éŒ²éŸ³é–‹å§‹</button>
        <button type="button" id="stop-btn" disabled>éŒ²éŸ³åœæ­¢</button>
        <audio id="audio-playback" controls></audio>    

        <!-- éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ç”¨ -->
        <input type="hidden" name="audio_data" id="audio-data">
        
        <!-- æ–‡å­—èµ·ã“ã—ãƒœã‚¿ãƒ³ -->
        <button type="button" id="btn"><span aria-hidden="true">ğŸ™</span> éŸ³å£°å…¥åŠ›</button>

        <!-- ä½ç½®æƒ…å ±ã®ãŸã‚ã®éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
        <input type="hidden" id="memo_location" name="memo_location">
        <input type="hidden" id="latitude" name="latitude">
        <input type="hidden" id="longitude" name="longitude">

        <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
        <button type="submit" id="submit-btn" disabled>é€ä¿¡</button>
    </form>
</div>

<!-- å¤–éƒ¨JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
<script src="{% static 'js/speechRecognition.js' %}"></script>
<script src="{% static 'js/audioRecorder.js' %}"></script>
<script src="{% static 'js/location.js' %}"></script>
<script src="{% static 'js/memoUI.js' %}"></script>
{% endblock %}

<!-- CSSãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
{% block head %}
<link rel="stylesheet" href="{% static 'css/memo.css' %}">
{% endblock %}
