{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/memo.css' %}">
{% endblock %}

{% block title %}MyTravelBook{% endblock %}

{% block content %}
{% include 'base_breadcrumb.html' %}

{% include "base_tabs.html" with active_tab="travelmemo" %}

<div class="container">
    <div id="delete-all-memos">
        <form action="{% url 'delete_all_memos' travel_record.id %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" onclick="return confirm('ã“ã®æ“ä½œã¯ã‚‚ã¨ã«æˆ»ã›ã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                ã™ã¹ã¦ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤
            </button>
        </form>
    </div>

    <div id="memo-list">
        {% for memo in memos %}
            <div class="memo">
                <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ†ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒã€éŸ³å£°ï¼‰ -->
                <div class="memo-content">
                    {% if memo.memo_text %}
                        <p>{{ memo.memo_text }}</p>
                    {% endif %}

                    {% if memo.memo_photo_path %}
                        <img src="{{ memo.memo_photo_path.url }}" alt="ãƒ¡ãƒ¢ã®ç”»åƒ" style="max-width: 300px;">
                    {% endif %}

                    {% if memo.audio_path %}
                        <audio controls>
                            <source src="{{ memo.audio_path.url }}" type="audio/mp3">
                            ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¿ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
                        </audio>
                    {% endif %}
                </div>

                <div class="memo-header">
                    <div class="memo-info">
                        <span class="memo-date">æŠ•ç¨¿æ—¥æ™‚: {{ memo.created_at }}</span>
                        {% if memo.memo_location %}
                            <span class="memo-location">å ´æ‰€: {{ memo.memo_location }}</span>
                        {% endif %}
                    </div>
                    <form action="{% url 'delete_memo' memo.id %}" method="post" style="display:inline;">                   
                        {% csrf_token %}
                        <button class="delete-btn" type="submit" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">å‰Šé™¤</button>
                    </form>
                </div>  
            </div>
        {% endfor %}
    </div>

    <div id="memo-form">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="input-container">
                <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
                <label for="photo-input" class="input-icon">ğŸ“·</label>
                <input 
                    type="file" 
                    id="photo-input" 
                    name="memo_photo_path" 
                    accept="image/*" 
                    style="display: none;">

                <!-- éŸ³å£°éŒ²éŸ³ -->
                <button type="button" id="record-btn">éŒ²éŸ³é–‹å§‹</button>
                <button type="button" id="stop-btn" disabled>åœæ­¢</button>
                <p id="recording-status" style="display: none;">éŒ²éŸ³ä¸­...</p>
                <audio id="audio-playback" controls></audio>    
                
                <!-- éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ç”¨ -->
                <input type="hidden" name="audio_data" id="audio-data">
                <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› -->
                <input type="text" id="memo_text" name="memo_text" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›">
                <!-- æ–‡å­—èµ·ã“ã— -->
                <button type="button" id="btn"><span aria-hidden="true">ğŸ™ï¸</span> éŸ³å£°å…¥åŠ›</button>
                <!-- å†™çœŸãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <div id="photo-preview">
                    <img id="preview-image" src="" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ" style="display: none;">
                </div>
                <!-- è¿½åŠ ãƒœã‚¿ãƒ³ -->
                <button type="submit" id="submit-btn" disabled>è¿½åŠ </button>
                <!-- ä½ç½®æƒ…å ± -->
                <input type="hidden" id="memo_location" name="memo_location">
                <input type="hidden" id="latitude" name="latitude">
                <input type="hidden" id="longitude" name="longitude">    
            </div>
        </form>
    </div>
</div>

<!-- å¤–éƒ¨JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
<script src="{% static 'js/speechRecognition.js' %}"></script>
<script src="{% static 'js/audioRecorder.js' %}"></script>
<script src="{% static 'js/location.js' %}"></script>
<script src="{% static 'js/memoUI.js' %}"></script>
{% endblock %}